---
title: "Use OrganizationServiceContext (Microsoft Dataverse) | Microsoft Docs" # Intent and product brand in a unique string of 43-59 chars including spaces
description: "The OrganizationServiceContext class lets you track changes, manage identities and relationships, and gives you access to the LINQ provider." # 115-145 characters including spaces. This abstract displays in the search result.
ms.date: 04/03/2022
author: kkanakas
ms.author: kartikka
ms.reviewer: pehecke
ms.topic: "article"
search.audienceType: 
  - developer
contributors:
 - JimDaly
 - phecke
---

# Use OrganizationServiceContext

[!INCLUDE[cc-terminology](../includes/cc-terminology.md)]

In Microsoft Dataverse, you can use several classes that implement the <xref:Microsoft.Xrm.Sdk.IOrganizationService> interface to access the Web services. Alternatively, you can use the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext> generated by the code generation tool to gain access to additional functionality. The `OrganizationServiceContext` class lets you track changes, manage identities and relationships, and gives you access to the LINQ provider. This class also contains a <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext>.<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.SaveChanges> method that you use to submit the changes to data that the context is tracking. This class is based on the same concept as the [DataServiceContext](/dotnet/api/system.data.services.client.dataservicecontext) class in Windows Communication Foundation (WCF) Data Services.  
  
To generate this class, provide a value for the `/serviceContextName` parameter when you generate early bound types. The code generation tool uses this name as the name of the generated class. For more information about how to use the code generation tool, see [Generate classes for early-bound programming using the SDK for .NET](generate-early-bound-classes.md). You can use the context instance when you develop applications, plug-ins, and workflow activities.  
  
<a name="how_to_use"></a>

## How to use the OrganizationServiceContext class  

To instantiate the context class, you must pass the class constructor an object that implements the <xref:Microsoft.Xrm.Sdk.IOrganizationService> interface. One option is to pass an instance of the <xref:Microsoft.Xrm.Tooling.Connector.CrmServiceClient> class. For more information about the <xref:Microsoft.Xrm.Sdk.IOrganizationService> interface, see [IOrganizationService Interface](iorganizationservice-interface.md).
  
The following code example shows how to create a new instance of the context class. In this example, the context class was named `AdventureWorksCycleServiceContext` by specifying that name using the `/serviceContextName` parameter when running the code generation tool:  
  
```csharp  
//For early bound types to work correctly, they have to be enabled on the proxy.  
_serviceProxy.EnableProxyTypes();  
AdventureWorksCycleServiceContext context = new AdventureWorksCycleServiceContext(_service);  
```  
 
After you create the context instance, you can begin to track creating, modifying, or deleting table rows (entity records).
  
The context must track any table row or relationship that you want to submit to Dataverse. For example, you could retrieve a row with a LINQ query and the context would track that row or you could use the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext>.<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.Attach(Microsoft.Xrm.Sdk.Entity)> method to cause the context to begin tracking the row. You can work with data in a client application and create new rows, create related rows, and modify existing rows, but you must call the `SaveChanges` method on tracked rows to commit changes to Dataverse.  
  
<a name="track_changes"></a>

## Track changes
 
To determine how a table row is tracked by the context, you can check the <xref:Microsoft.Xrm.Sdk.Entity.EntityState> property on the derived `Entity` instance. You must notify the context to track a row from Dataverse by calling various methods or by using a LINQ query. All rows returned from a LINQ query are tracked by the service context.  
  
You can add objects to the service context by calling one of the following methods in <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext>.  
  
|Method|Use|  
|------------|---------|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.AddObject(Microsoft.Xrm.Sdk.Entity)>|Adds a table row to the set of rows the service context is tracking. The status of the row in the context is set to `Created`. If the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.SaveChanges> method is called, this row will be created or added to the server.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.Attach(Microsoft.Xrm.Sdk.Entity)>|Adds a table row to the set of rows the service context is tracking. The status of the row in the context is set to `Unchanged`. If the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.SaveChanges> method is called, this row will not be sent to the server unless its status changes.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.CreateQuery(System.String)>|Adds the results of a query to the set of rows the service context is tracking.|  
  
<a name="track_related"></a>

## Track related objects

In Dataverse, the service context lets you create and update relationships between table rows. The navigation properties generated by the CrmSvcUtil.exe tool and located in the early-bound classes let you access and change related row properties and relationships. The service context must be tracking the related row for the related row to be available to be updated on the server.  
  
Use the following methods in <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext> to work with related rows and to add the row to the service context:  
  
|Method|Use|  
|------------|---------|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.AddRelatedObject(Microsoft.Xrm.Sdk.Entity,Microsoft.Xrm.Sdk.Relationship,Microsoft.Xrm.Sdk.Entity)>|Adds the target to the context. Calls the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.Attach(Microsoft.Xrm.Sdk.Entity)> method on the target table row and then calls the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.AddLink(Microsoft.Xrm.Sdk.Entity,Microsoft.Xrm.Sdk.Relationship,Microsoft.Xrm.Sdk.Entity)> method between the source row and the target (related) row.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.AttachLink(Microsoft.Xrm.Sdk.Entity,Microsoft.Xrm.Sdk.Relationship,Microsoft.Xrm.Sdk.Entity)>|Adds the related row to the context for tracking. The status of the row in the context is set to `Unchanged`.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.AddLink(Microsoft.Xrm.Sdk.Entity,Microsoft.Xrm.Sdk.Relationship,Microsoft.Xrm.Sdk.Entity)>|Creates a relationship between the source and target rows. Adds the target to the context. The status of the target row in the context is set to `Created`.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.LoadProperty(Microsoft.Xrm.Sdk.Entity,System.String)>|Loads the related entity set for the specified relationship. Gives access to related rows by using the navigation property. Call the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.AddObject(Microsoft.Xrm.Sdk.Entity)> method on the related row after you have accessed the row by using a navigation property on the parent row.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.UpdateObject(Microsoft.Xrm.Sdk.Entity)>|Changes the state of the specified row in the `OrganizationServiceContext` to Modified.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.DeleteObject(Microsoft.Xrm.Sdk.Entity)>|Changes the state of the specified row to be deleted in the `OrganizationServiceContext`.|  
  
<a name="BKMK_LoadRelatedEntities"></a>

### Load related table rows using navigation properties

Related rows for rows that you have retrieved using LINQ will be null until you use <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.LoadProperty(Microsoft.Xrm.Sdk.Entity,Microsoft.Xrm.Sdk.Relationship)> to retrieve them. The following code sample shows how to access Task rows associated with a specific Contact row.  
  
```csharp  
Contact pam = context.ContactSet.Where(c => c.FirstName == "Pamela").FirstOrDefault();  
if (pam != null)  
{  
// pam.Contact_Tasks is null until you use LoadProperty  
    context.LoadProperty(pam, "Contact_Tasks");  
    Task firstTask = pam.Contact_Tasks.FirstOrDefault();  
}  
```

### Use the AddLink method

 You can use the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.AddLink(Microsoft.Xrm.Sdk.Entity,Microsoft.Xrm.Sdk.Relationship,Microsoft.Xrm.Sdk.Entity)> method to create associations. You must call the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.SaveChanges> method before the server is updated with the new link information.  
  
 The following code example shows how to create an association between a contact and an account.  
  
```csharp  
Relationship relationship = new Relationship("account_primary_contact");  
context.AddLink(contact, relationship, account);  
context.SaveChanges();  
```  

<a name="save_changes"></a>

## Save changes

The service context holds a graph of the table rows it is tracking. The order in which the service context processes table changes and submits them to the server is important. Updates to primary table rows are processed, and then related table rows are processed. If a value is set on the primary table row by the related table row, that value is used when updating data on the server.  
  
If an error occurs when entity information is being saved, a new exception type that contains the <xref:Microsoft.Xrm.Sdk.SaveChangesResult> is thrown by the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext>.<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.SaveChanges> method, regardless of the value of the <xref:Microsoft.Xrm.Sdk.Client.SaveChangesOptions> parameter that is passed into the method.  
  
<a name="virtual"></a>

## Use virtual methods when the context is changed

Sometimes it may be necessary to take actions based on changes in the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext>. To facilitate this, virtual methods are provided to allow you to intercept or be notified of an operation. To take advantage of these methods, you either have to derive from <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext> or change the generated service context.The following table lists the virtual methods.  
  
|Method|Description|  
|------------|-----------------|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.OnBeginEntityTracking(Microsoft.Xrm.Sdk.Entity)>|Called after a table row is attached to the `OrganizationServiceContext`.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.OnBeginLinkTracking(Microsoft.Xrm.Sdk.Entity,Microsoft.Xrm.Sdk.Relationship,Microsoft.Xrm.Sdk.Entity)>|Called after a link is attached to the `OrganizationServiceContext`.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.OnEndEntityTracking(Microsoft.Xrm.Sdk.Entity)>|Called after a table row is detached from the `OrganizationServiceContext`.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.OnEndEntityTracking(Microsoft.Xrm.Sdk.Entity)>|Called after a link is detached from the `OrganizationServiceContext`.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.OnExecuting(Microsoft.Xrm.Sdk.OrganizationRequest)>|Called immediately before a request is submitted to Dataverse.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.OnExecute(Microsoft.Xrm.Sdk.OrganizationRequest,Microsoft.Xrm.Sdk.OrganizationResponse)>|Called immediately after a request is submitted to the Dataverse, regardless of whether an exception occurred or not.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.OnSavingChanges(Microsoft.Xrm.Sdk.Client.SaveChangesOptions)>|Called before any operations occur after a call to `SaveChanges`.|  
|<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.OnSaveChanges(Microsoft.Xrm.Sdk.SaveChangesResultCollection)>|Called when all of the operations for a call to `SaveChanges` have completed, or when there is a failure.|  


<a name="use_context"></a>   

## Data Operations

You can modify, create, and delete objects in the service context, and Dataverse tracks the changes that you made to these objects. When the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext>.<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.SaveChanges> method is called, Dataverse generates and executes commands that perform the equivalent insert, update, or delete statements against data in Dataverse.  
  
When working with early-bound `Entity` derived classes, you use the table name and column schema name to specify a table row or column to work with. Schema names are defined in <xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.EntityMetadata.SchemaName> and <xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata>.<xref:Microsoft.Xrm.Sdk.Metadata.AttributeMetadata.SchemaName>, or you can use the class and property names shown in the code-generated file.The following sample shows how to assign a value to the email attribute of a new contact instance.  
  
```csharp  
Contact contact = new Contact();
contact.EMailAddress1 = "sonny@contoso.com";  
```

<a name="create_new"></a>   

## Create a new table row

 When you want to insert table data into Dataverse, you must create an instance of an entity type and add the object to an service context. The service context must be tracking the object before it can save the object to Dataverse.  
  
 When creating a new table row, you add the entity object to the service context by using the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.AddObject(Microsoft.Xrm.Sdk.Entity)> method.  
  
 The following sample shows how to instantiate and save a new contact by using the entity data model. It also demonstrates how to access a custom attribute.  
  
```csharp  
OrganizationServiceContext orgContext =new OrganizationServiceContext(svc);  
Contact contact = new Contact()     
 {  
   FirstName = "Charles",  
   LastName = "Brown",  
   Address1_Line1 = "123 Main St.",  
   Address1_City = "Des Moines",  
   Address1_StateOrProvince = "IA",  
   Address1_PostalCode = "21254",  
   new_twittername = "Chuck",  
   Telephone1 = "123-234-5678"  
 };   
orgContext.AddObject(contact);
orgContext.SaveChanges();  
```  

There are several points to note in the previous code example. First, after a new contact is instantiated, you pass that contact object to the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext>.<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.AddObject(Microsoft.Xrm.Sdk.Entity)> method so the context can begin tracking the object. The second point to note is that the new object is saved to the server by using the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext>.<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.SaveChanges> method.  
  
After you add an object to the context and before the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext>.<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.SaveChanges> method is called, the context generates an ID for the new object. An exception that contains the `SaveChangesResults` is thrown from the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.SaveChanges> method if any updates to the Dataverse data fail.  
  
<a name="update"></a>   

## Update a table row  

Dataverse tracks changes to objects that are attached to the service context. To modify an existing table row, you must first add the object to the context. To add an object to the context, you must first retrieve the table row from Dataverse and then add the object to the context by using the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.Attach(Microsoft.Xrm.Sdk.Entity)> method. Once the object is being tracked by the context, you can update the row by setting its columns (entity attributes).  
  
The following sample shows how to update an account column by using early bound classes.  
  
```csharp  
Account.EMailAddress1 = "Contoso-WebMaster@contoso.com";  
```  
  
 The following sample shows how to delete a column value.  
  
```csharp  
Account.EMailAddress1 = null;  
```  
  
 There are two partial methods named `OnPropertyChanging` and `OnPropertyChanged` for each table row. These methods are called in the property setter. You can extend these methods by using partial classes to insert custom business logic.  
  
<a name="delete"></a>   

## Delete a table row 

To delete a table row, the service context must be tracking the object. Once the object is on the context, you can use the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.DeleteObject(Microsoft.Xrm.Sdk.Entity)> method to mark the object on the context for deletion. Note that the table row in Dataverse is not deleted until the <xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext>.<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext.SaveChanges> method is called.  
  
### See also

[LINQ query examples using OrganizationServiceContext with Dataverse](linq-query-examples.md)<br />
[Generate classes for early-bound programming using the SDK for .NET](generate-early-bound-classes.md)<br />
<xref:Microsoft.Xrm.Sdk.IOrganizationService><br />
<xref:Microsoft.Xrm.Sdk.Client.OrganizationServiceContext>

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]
